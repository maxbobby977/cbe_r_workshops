---
title: "Ec50 Project 1"
author: "Max Bobby"
date: "2/24/2021"
output:
  pdf_document: 
    fig_crop: no
  html_document: default
header-includes:
  - \usepackage{graphicx}
  - \graphicspath{ {./images/} }
  - \usepackage{setspace}\doublespacing
---

\clearpage
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Read in data
library(haven)
library(ggplot2)
df = read_dta("atlas.dta")
# defining data frames for both westchester and larchmont
ny = df[df$state == 36,]
westchester = df[df$state == 36 & df$county == 119,]
larchmont = df[df$state == 36 & df$county == 119 & (df$tract == 007000 | df$tract == 006900 | df$tract == 007100 | df$tract == 007300 | df$tract == 007200 | df$tract == 007401 | df$tract == 007402),]
```

## About Larchmont & Mamaroneck

With the exception of the Bronx, Westchester County is currently the most populous county in New York State, with a estimated population of $967,506$ individuals as of 2019 \footnote{"QuickFacts Westchester County, New York". U.S. Census Bureau.}. I grew up in the town of Larchmont (a part of the town of Mamaroneck, and not to be confused with the Village of Larchmont, although we will consider it in this project as a census tract of interest), which is broken up into six census tracts Larchmont-Mamaroneck is a relatively affluent suburb with an excellent school system, and I was very privileged to have grown up there — up until my move to Cambridge in the fall of 2018, it was the only area I had ever resided in. 

Generally speaking, Westchester is one of the more affluent counties in the United States, with a median income of $\$83,422$ as of 2014 \footnote{"QuickFacts Westchester County, New York". United States Census Bureau.} — is only surpassed by New York county in annual median income. Westchester is also a relatively large municipality, and as a result is home to a diverse range of cities, towns, and villages. In terms of the demographic breakdown, Westchester is $53.1\%$ white, $16.6\%$ black, $1.1\%$ Native American or Alaska Native, $6.4\%$ Asian, and $25.1\%$ Hispanic or Latino \footnote{"US Census QuickFacts: Westchester County". January 31, 2020.}. With regards to the demographics of the areas immediately surrounding my home, or more specifically, the Larchmont-Mamaroneck area, Larchmont is less populous with a population of $\sim 6,000$, and is $82.1\%$ White, $7.16\%$ Hispanic or Latino, $4.96\%$ Asian, and $1.37\%$ Black \footnote{https://datausa.io/profile/geo/larchmont-ny}. Mamaroneck has a more sizable population of around $\sim 19,000$, and is $63\%$ White, $14.6\%$ Hispanic or Latino, $6.11\%$ Black, and $5.16\%$ Asian.

```{r results = 'asis', echo=FALSE}
# mean income
library(xtable)
med_inc = data.frame(location=character(), median_inc=numeric())

med_inc = rbind(med_inc, list("United States", mean(na.omit(df$med_hhinc2016))))
med_inc = rbind(med_inc, list("New York", mean(na.omit(ny$med_hhinc2016))))
med_inc = rbind(med_inc, list("Westchester", mean(na.omit(westchester$med_hhinc2016))))
med_inc = rbind(med_inc, list("Larchmont", mean(larchmont$med_hhinc2016)))

colnames(med_inc) = c("Location", "Median Income")
xtable(med_inc)

# report mean of upwards mobility
up_mobil = data.frame(location=character(), upw_mobil=numeric())
up_mobil = rbind(up_mobil, list("United States", mean(na.omit(df$kfr_pooled_pooled_p25))))
up_mobil = rbind(up_mobil, list("New York", mean(na.omit(ny$kfr_pooled_pooled_p25))))
up_mobil = rbind(up_mobil, list("Westchester", mean(na.omit(westchester$kfr_pooled_pooled_p25))))
up_mobil = rbind(up_mobil, list("Larchmont", mean(larchmont$kfr_pooled_pooled_p25)))

colnames(up_mobil) = c("Location", "Mean Upward Mobility")
xtable(up_mobil)
```

Generally speaking, both Westchester County and the Larchmont-Mamaroneck area are better off than New York State and the rest of the country in terms of mean income — the mean of median incomes in the Larchmont-Mamaroneck area is quite substantial (even greater than the value reported in the 2014 census). Indeed, incomes in the Larchmont-Mamaroneck area are almost double that of the entire United States. Residents of Westchester County and the Larchmont-Mamaroneck area are also better off than New York State and the greater United States population in terms of upwards mobility. Somewhat surprising, despite the fact that residents of the Larchmont-Mamaroneck area earn almost $10\%$ more than the average of median incomes in Westchester County, they appear to actually have a lower value of upwards mobility on average than the rest of the county. This may also imply that higher household incomes are not necessarily correlated with higher values of upwards mobility in children — we will continue to explore this in the next section of the project. We can also visualize these differences in income by creating histograms, which are depicted below.

```{r, echo=FALSE, fig.align='center', fig.width=4, fig.height=4, warning = FALSE, message = FALSE, out.width="8.5in"}
ggplot(data=na.omit(westchester), aes(westchester$kfr_pooled_pooled_p25)) + geom_histogram() + ggtitle("Westchester Upwards Mobility") + xlab("Mean pctile rank in the national distribution of household income in 2014-2015") + ylab("Frequency") + stat_bin(bins=10) + theme(axis.text.x = element_text(color = "grey20", size = 5))

ggplot(data=na.omit(westchester), aes(westchester$kfr_pooled_pooled_p25)) + geom_histogram() + ggtitle("kfr_pooled_pooled_25") +
  xlab("Mean pctile rank in the national distribution of household income in 2014-2015") + ylab("Frequency") + stat_bin(bins=10) + theme(axis.text.x = element_text(color = "grey20", size = 5))

```


\begin{center}
  \includegraphics[width=3.5in]{"low_inc.png"}
  \includegraphics[width=3.5in]{"high_inc.png"}
\end{center}

## Ideating a Hypothesis

I first examined a variety of patterns and outcomes in my home area in a visual context by utilizing the Opportunity Atlas tool provided to us. I was primarily interested in learning more about the effects of different patterns within my hometowns on upwards mobility, however, unfortunately, (or fortunately) Larchmont & Mamaroneck have an insignificant rate of incarcerations, and in a similar vein, many of the other patterns were difficult to utilize here. As a result, I elected to examine upwards mobility in the context of wealth during childhood. 

Visually, it already clear that there is a significant relationship between being a low-income child and upwards mobility (and vice versa) — children from higher income families earn more as adults. This is quite apparent on the above maps: children of low-income parents earn salaries significantly closer to the median US salary than those of high income parents, who tend to earn salaries well within the $75^{th}$ percentile of US salaries. This makes sense intuitively, as children of higher-income parents generally have  access to greater opportunities than those of lower income parents, as wealthier families are more likely to have better connections for employment, and perhaps more significantly, the discretionary budget necessary to pay for extra educational preparation (tutors, courses, camps) that ultimately facilitate finding high-paying employment opportunities. As an aside, while I was resided in Larchmont, I certainly noticed that wealthier families paid for far more academic programs than those who were less financially well-off.

## Testing the Hypothesis

Although I had already determined that the relationship between parent income and upwards mobility was something that merited further investigation, I also hypothesized that (in a similar vein), travel time might be a significant predictor. Although, intuitively, one might think that longer travel times would be associated with lower upwards mobility, I think that longer travel times might actually be associated with greater upwards mobility in the Larchmont-Mamaroneck area. My reasoning behind this is as follows: many of the wealthiest individuals in Larchmont and Mamaroneck work in New York City, which is an $\sim 40$ minute regardless of mode of transportation (many such individuals work in the finance industry, which is predominantly concentrated in Manhattan). As such, I might imagine that areas with a larger share of adults with a commute time of $>15$ minutes might actually have greater upwards mobility, and might also help explain some variations in the area that I lived in. 

I wanted to visualize the distribution of *med_hhinc2016* and *travel_time15_2016* in both the Larchmont-Mamaroneck area and greater Westchester County. 

Then, I elected to investigate this idea by constructing correlation coefficients and a linear regression of *kfr_pooled_pooled_p25* on *med_hhinc2016* and *travel_time15_2016*. Since I was working with a small dataset for areas near my town, I decided to calculate these values for all of Westchester County.

```{r results = 'asis', echo=FALSE}
# calculate 
cor_par_inc.larc = cor(larchmont$kfr_pooled_pooled_p25, larchmont$med_hhinc2016, use = "complete.obs")
cor_travel.larc = cor(larchmont$kfr_pooled_pooled_p25, larchmont$traveltime15_2010, use = "complete.obs")

cor_par_inc.west = cor(westchester$kfr_pooled_pooled_p25, westchester$med_hhinc2016, use = "complete.obs")
cor_travel.west = cor(westchester$kfr_pooled_pooled_p25, westchester$traveltime15_2010, use = "complete.obs")

lm1.larc = lm(kfr_pooled_pooled_p25 ~ med_hhinc2016 + traveltime15_2010, df)
lm1.west = lm(kfr_pooled_pooled_p25 ~ med_hhinc2016 + traveltime15_2010, df)

# Larchmont Correlation Coefficients

# Westchester Correlation Coefficients

cor.l.w = data.frame(mhhinc=numeric(), traveltime=numeric())
cor.l.w = rbind(c(cor_par_inc.larc, cor_travel.larc), c(cor_par_inc.west, cor_travel.west))
colnames(cor.l.w) = c("corr(med_hhinc, upwards mobility)", "corr(travel time, upwards mobility")
row.names(cor.l.w) = c("Larchmont", "Westchester")
print(xtable(cor.l.w))
```

Upon analyzing the regression, I determined that both median household income and travel time were extremely significant predictors of upwards mobility $p < 0.001$. 

Somewhat fascinatingly, a cursory analysis of the correlation coefficients tells us that in the Larchmont-Mamaroneck area, having a higher median income is actually slightly negatively correlated with a higher upwards mobility, and having a higher proportion of adults with travel times less than 15 minutes is slightly positively correlated with higher upwards mobility. While this is precisely the opposite of the original hypothesis I posited, this may indicate that my assumption that higher travel times in general may be correlated with a higher income in this region. Furthermore, this could possibly reflect the discrepancy between higher household incomes and upwards mobility that we observed in the previous section of the project. Indeed, we observed that despite residents of the Larchmont-Mamaroneck area having a significantly higher income than the rest of the county, they actually had a slightly lower value for upward mobility.

Binscatter plots help visualize this correlation, and are depicted below. 

```{r, echo=FALSE, out.width='\\textwidth', fig.align='center', fig.width=4, fig.height=4, warning = FALSE, message = FALSE}
library(statar)
ggplot(larchmont, aes(x = med_hhinc2016, y = kfr_pooled_pooled_p25)) + labs(title="Larchmont Median Income")+
  stat_binmean(n = 20) + 
  stat_smooth(method = "lm", se = FALSE)
ggplot(larchmont, aes(x = traveltime15_2010, y = kfr_pooled_pooled_p25)) + labs(title="Larchmont Travel Time")+
  stat_binmean(n = 20) + 
  stat_smooth(method = "lm", se = FALSE)
ggplot(westchester, aes(x = med_hhinc2016, y = kfr_pooled_pooled_p25)) + labs(title="Westchester Median Income") +
  stat_binmean(n = 20) + 
  stat_smooth(method = "lm", se = FALSE)
ggplot(westchester, aes(x = traveltime15_2010, y = kfr_pooled_pooled_p25)) + labs(title="Westchester Travel Time") +
  stat_binmean(n = 20) + 
  stat_smooth(method = "lm", se = FALSE)
```

I wanted to further analyze my ideas regarding the relationship between higher household median incomes and longer travel times, and more specifically, that at least in the Larchmont-Mamaroneck area, higher parents incomes would be correlated with longer travel times. I also elected to examine the this theory in the context of the Westchester area, in order to potentially gain more insight into this relationship. 

```{r results = 'asis', echo=FALSE}
cor_inc_travel = cor(larchmont$traveltime15_2010, larchmont$med_hhinc2016, use = "complete.obs")
cor_inc_travel.w = cor(westchester$traveltime15_2010, westchester$med_hhinc2016, use = "complete.obs")

cor.inc.travel.df = data.frame(coef.travel = c(cor_inc_travel, cor_inc_travel.w))
colnames(cor.inc.travel.df) = "Correlation Coeffecient"
row.names(cor.inc.travel.df) = c("Larchmont", "Westchester")
xtable(cor.inc.travel.df)
```

These correlation coefficients reveal that there is indeed a strong negative correlation between the share of travel times less than 15 minutes, and median income level, which may imply that my theory regarding the relationship between these two characteristics is correct.

My calculations for the entirety of Westchester, however, seem more in-line with my hypothesis that higher levels of median income are correlated with higher levels of upward mobility, as we see a relatively strong correlation between the two at the county level. Fascinatingly, we see that there is also a slight negative correlation between share of travel times less than 15 minutes and upwards mobility. This implies to me that my assumption may be partially correct (that longer travel times are correlated with upwards mobility) for Westchester County as a whole. Logically, given my knowledge about the layout of Westchester, this makes sense — wealthier towns and villages tend to be farther away from the city, despite the fact that wealthier residents often work in Manhattan. There is a lot of noise in this data — as shown in the binscatter there are quite few data points, and several significant outliers. Specifically, two data points with very high median income in the Larchmont-Mamaroneck binscatter have relatively low upwards mobility. The plot with the least noise is likely the Westchester median income binscatter, which in-part explains the relatively high correlation coefficient that we observed. One of the most interesting.

I also decided to analyze the upwards mobility in the context of different demographics, in an attempt to shed more light on some of the results I observed. I first decided to perform a multivariate regression of pooled upwards mobility on shares of different races in the Larchmont-Mamaroneck area and Westchester. Unfortunately, no data on Native American or Alaska native population share was available. 

```{r echo=FALSE}
lm2 = lm(kfr_pooled_pooled_p25~share_white2010 + share_black2010 + share_hisp2010 + share_asian2010, larchmont)
summary(lm2)

lm3 = lm(kfr_pooled_pooled_p25~share_white2010 + share_black2010 + share_hisp2010 + share_asian2010, westchester)
summary(lm3)
```

This linear model seemed to indicate that shares of different demographics were not significant predictors of overall pooled upward mobility in both the Westchester and Larchmont areas ($p > 0.05$ for every predictor). 

## Analysis of Results
I have learned that parent's income is not necessarily the most important determinant of economic opportunity based off of my hypothesis testing, at least in the Larchmont-Mamaroneck area. This was a surprising result to me, as based off of the maps and my own intuitions, it seems logical that a higher household income would result in more opportunities for earnings potential for a child. That being said, given the affluence of the Larchmont-Mamaroneck community, it is possible that many children simply do not have a need to work (or earn as much), once they reach working-age (although I am not entirely sure how income is calculated in this study). Results for Westchester County were much less surprising, with a relatively strong correlation between parental household earnings and upwards mobility. 




\newpage

## Code Appendix

```{r echo=FALSE}
# relevant tracts
# my area: 007000
# larchmont 2: 006900
# larchmont village: 007100
# mamaroneck 1: 007300
# mamaroneck 2 (orienta): 007200
# mamaroneck 3: 007401
# mamaroneck 4: 007402

# summary statistics
summary(df$kfr_pooled_pooled_p25)
```

```{r echo=FALSE}
sds = data.frame(Pooled = numeric(), White=numeric(), Black=numeric(), Hispanic=numeric(), NativeAmerican=numeric(), Asian=numeric())

# sd of country tracts
pooled = sd(na.omit(df$kfr_pooled_pooled_p25))
white = sd(na.omit(df$kfr_white_pooled_p25))
black = sd(na.omit(df$kfr_black_pooled_p25))
hisp = sd(na.omit(df$kfr_hisp_pooled_p25))
natam = sd(na.omit(df$kfr_natam_pooled_p25))
asian = sd(na.omit(df$kfr_asian_pooled_p25))

country = c(pooled, white, black, hisp, natam, asian)

sds = rbind(sds, country)

# sd of state
pooled = sd(na.omit(df[df$state == 36,]$kfr_pooled_pooled_p25))
white = sd(na.omit(df[df$state == 36,]$kfr_white_pooled_p25))
black = sd(na.omit(df[df$state == 36,]$kfr_black_pooled_p25))
hisp = sd(na.omit(df[df$state == 36,]$kfr_hisp_pooled_p25))
natam = sd(na.omit(df[df$state == 36,]$kfr_natam_pooled_p25))
asian = sd(na.omit(df[df$state == 36,]$kfr_asian_pooled_p25))

state = c(pooled, white, black, hisp, natam, asian)
sds = rbind(sds, state)

# sd of county (Westchester)
westchester = df[df$state == 36 & df$county == 119,]
pooled = sd(na.omit(westchester$kfr_pooled_pooled_p25))
white = sd(na.omit(westchester$kfr_white_pooled_p25))
black = sd(na.omit(westchester$kfr_black_pooled_p25))
hisp = sd(na.omit(westchester$kfr_hisp_pooled_p25))
natam = sd(na.omit(westchester$kfr_natam_pooled_p25))
asian = sd(na.omit(westchester$kfr_asian_pooled_p25))

county = c(pooled, white, black, hisp, natam, asian)
sds = rbind(sds, county)

pooled = sd(na.omit(larchmont$kfr_pooled_pooled_p25))
white = sd(na.omit(larchmont$kfr_white_pooled_p25))
black = sd(na.omit(larchmont$kfr_black_pooled_p25))
hisp = sd(na.omit(larchmont$kfr_hisp_pooled_p25))
natam = sd(na.omit(larchmont$kfr_natam_pooled_p25))
asian = sd(na.omit(larchmont$kfr_asian_pooled_p25))

town = c(pooled, white, black, hisp, natam, asian)
sds = rbind(sds, town)

row.names(sds) = c("Country", "New York", "Westchester", "Larchmont")
colnames(sds) = c("Pooled", "White", "Black", "Hispanic", "Native American", "Asian")

print(sds)
```


```{r echo=FALSE}
# Plots of Histograms
library(ggplot2)

# pooled histogram
ggplot(data=na.omit(westchester), aes(westchester$kfr_pooled_pooled_p25)) + geom_histogram() + ggtitle("kfr_pooled_pooled_25") +
  xlab("Mean pctile rank in the national distribution of household income in 2014-2015") + ylab("Frequency")

# White Pooled
ggplot(data=na.omit(westchester), aes(westchester$kfr_white_pooled_p25)) + geom_histogram() + ggtitle("kfr_white_pooled_25") +
  xlab("Mean pctile rank in the national distribution of household income in 2014-2015") + ylab("Frequency")

# Black Pooled
ggplot(data=na.omit(westchester), aes(westchester$kfr_black_pooled_p25)) + geom_histogram() + ggtitle("kfr_black_pooled_p25") +
  xlab("Mean pctile rank in the national distribution of household income in 2014-2015") + ylab("Frequency")

# Hispanic Pooled
ggplot(data=na.omit(westchester), aes(westchester$kfr_hisp_pooled_p25)) + geom_histogram() + ggtitle("kfr_hisp_pooled_p25") +
  xlab("Mean pctile rank in the national distribution of household income in 2014-2015") + ylab("Frequency")

# Natam data not available in Westchester
# ggplot(data=na.omit(westchester), aes(westchester$kfr_natam_pooled_p25)) + geom_histogram() + ggtitle("kfr_natam_pooled_p25") +
  # xlab("Mean pctile rank in the national distribution of household income in 2014-2015") + ylab("Frequency")

# Asian Pooled
ggplot(data=na.omit(westchester), aes(westchester$kfr_asian_pooled_p25)) + geom_histogram() + ggtitle("kfr_asian_pooled_p25") +
  xlab("Mean pctile rank in the national distribution of household income in 2014-2015") + ylab("Frequency")
```

```{r echo=FALSE}
# Correlation coefficients
cor_commute = cor(westchester$kfr_pooled_pooled_p25, westchester$mean_commutetime2000, use = "complete.obs")
cor_jail = cor(westchester$kfr_pooled_pooled_p25, westchester$jail_pooled_pooled_p25, use = "complete.obs")
cor_poor = cor(westchester$kfr_pooled_pooled_p25, westchester$poor_share2010, use = "complete.obs")
cor_job_den = cor(westchester$kfr_pooled_pooled_p25, westchester$job_density_2013, use = "complete.obs")

cor_commute
cor_jail
cor_poor
cor_job_den
```

```{r}
# Binscatter Plots

# commute time
library(statar)
ggplot(westchester, aes(x = traveltime15_2010, y = kfr_pooled_pooled_p25)) +
  stat_binmean(n = 20) + 
  stat_smooth(method = "lm", se = FALSE)

# jail 2010
ggplot(westchester, aes(x = jail_pooled_pooled_p25 , y = kfr_pooled_pooled_p25)) +
  stat_binmean(n = 20) + 
  stat_smooth(method = "lm", se = FALSE)

# poor share
ggplot(westchester, aes(x = poor_share2010 , y = kfr_pooled_pooled_p25)) +
  stat_binmean(n = 20) + 
  stat_smooth(method = "lm", se = FALSE)

# job density
ggplot(westchester, aes(x = job_density_2013 , y = kfr_pooled_pooled_p25)) +
  stat_binmean(n = 20) + 
  stat_smooth(method = "lm", se = FALSE)
```



```{r}
lm2 = lm(kfr_pooled_pooled_p25~share_white2010 + share_black2010 + share_hisp2010 + share_asian2010, larchmont)
summary(lm2)

lm3 = lm(kfr_pooled_pooled_p25~share_white2010 + share_black2010 + share_hisp2010 + share_asian2010, westchester)
summary(lm3)
```

