---
title: "CBE R Workshop"
author: "Max & Evelyn"
date: "2/21/2021"
output:
  rmarkdown::html_document:
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Intro to R and RMarkdown

This is what a code chunk is:

```{r}
print("hello world! :)")
```

The code within the chunk, which is demarcated by three tick symbols (`), will be executed. You can add tinker with different options in the **chunk header**, which is enclosed by the two brackets (\{\}). One useful chunk option is *echo = FALSE*, which suppresses the code from showing and only produces an output.

For example, if we add *echo = FALSE* to the above code chunk, we only get the printed output.

```{r echo=FALSE}
print("hello world! :)")
```

You can "knit" an RMarkdown by clicking the yarn icon, or by using the keyboard shortcut (there are a lot of these in RStudio): CTRL/CMD + SHIFT + K. This creates a prettier HTML output.

You can save a document by going to File-> Save or with the shortcut CTRL/CMD + S.

```{r}
print("Hello world")

# The above is a line of code. This is a comment.
```

You can create comments, or sections of text that will not be executed as code, by adding a '#' in front of the section.

## Loading packages and importing data

Different packages in R do different things. There's a package that helps you plot pretty things called **ggplot**, a package that contains a bunch of useful functions for data transformation and analysis called **dplyr**, and even a fortune teller package. We'll be installing the first two with the following lines of code:

```{r}
install.packages("dplyr")
install.packages("ggplot2")
```

Once you've installed them, you need to *load* them before use. Every time you restart R, it forgets about your previous session. You can load packages like so:

```{r}
library(dplyr)
library(ggplot2)
```

## Exploratory analysis & descriptive stats

We will be working with a publicly available dataset from the CDC called "COVID-19 Case Surveillance Public Use Data".

Once you have it downloaded, make sure it is in the same folder as the RMarkdown document you have with code. You can read in a CSV file using a function called read.csv("FILENAME.csv")

```{r}
vaccine_data = read.csv("vaccine_data.csv")
```

We can use the summary function to immediately display a number of summary statistics.

```{r}
summary(vaccine_data)
```

Let's say we want to take a peek at our spreadsheet, but we we're not feeling numbers today. We can use the view function to see the data right in RStudio. 

```{r}
View(vaccine_data)
```

Summary
View
glimpse
variables and variable types
NA values

You can think of variables and columns as synonymous in a data table.



## Data transformation with dplyr

Now that we've checked our data for any loose ends, like NA values, let's get to manipulating the data. The **dplyr** package contains various functions that help you transform variables.

Here is a quick list of what the most common functions do:
* `filter()` - subsets your data by certain values
* `select()` - selects or deselects certain variables
* `arrange()` - sorts your data in descending or ascending value
* `summarize()` - calculates an output that is a single value
* `mutate()` - creates new columns

Let's say we're only interested in viewing the observations from February 21, 2021.

```{r}
vaccine_data %>%
  filter(date == "2021-02-21")
```

Now you can see there are only 65 observations that match this condition.

We only want the variable `people_fully_vaccinated`.

```{r}
vaccine_data %>%
  select(people_fully_vaccinated)
```

What if we want all variables *besides* `people_fully_vaccinated`?

```{r}
vaccine_data %>%
  select(-people_fully_vaccinated)
```

Now let's see which state has the highest number of `people_fully_vaccinated` as of February 21, 2021.

```{r}
vaccine_data %>%
  filter(date == "2021-02-21") %>%
  arrange(desc(people_fully_vaccinated))
```

`summarize()` is a useful function for basic statistics, like `mean()`, `median()`, or `sum()`. 

```{r}
vaccine_data %>%
  filter(date == "2021-02-21",
         location != "United States",
         !is.na(people_fully_vaccinated)) %>%
  summarize(mean(people_fully_vaccinated))
```

However, `mutate()` is useful for calculating a unique value per observation. Let's say we want to find the rate of vaccinations and distributions:

```{r}
vaccine_data %>%
  filter(!is.na(people_vaccinated),
         !is.na(total_distributed)) %>%
  mutate(newvariable = people_vaccinated / total_distributed)
```

There's so much more you can do with **dplyr**. Another useful function is *group_by()*, which creates groups based on a certain variable. For example, finding the mean number of people fully vaccinated isn't very helpful when your data contains observations from New York in December 2020 and Oregon in February 2021.

*group_by()* essentially sidesteps this problem of comparison by calculating statistics within a given group.

```{r}
vaccine_data %>%
  select(date, people_fully_vaccinated, location) %>%
  filter(!is.na(people_fully_vaccinated)) %>%
  group_by(date) %>%
  summarize(mean(people_fully_vaccinated))

# Always gut check your results!
```




## Plotting with ggplot

geom_bar
geom_hist
geom_point
scatter
boxplot
facet_wrap
titles / labels
themes


scale_coord_flip
geom_hline

## Other R applications

You can do so much more with R, including but not limited to mapping / GIS stuff!!! And making a website! And election predictions, and COVID dashboards (link it), and ML

Other resources - R Primer









